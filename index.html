<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>QR Reader</title>
    <body>
      <div id="qr-content">
        <div id="qr-reader"></div>
      </div>
    </body>
    <script>
      // First we get the viewport height and we multiple it by 1% to get a value for a vh unit
      let h = window.screen.height;
      let w = window.screen.width;
      let minValue = Math.min(w, h);

      // Then we set the value in the --minV custom property to the root of the document
      document.documentElement.style.setProperty("--minV", `${minValue}px`);
    </script>
    <style>
      #html5-qrcode-button-camera-stop {
        visibility: hidden;
        display: none;
      }

      #qr-content {
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #qr-reader,
      video {
        height: var(--minV);
        width: var(--minV);
      }

      #qr-reader__dashboard {
        display: none;
      }
    </style>
    <script src="./scripts/html5-qrcode.min.js"></script>
    <script>
      screen.orientation.addEventListener("change", (event) => {
        const type = event.target.type;
        const angle = event.target.angle;
        console.log(`ScreenOrientation change: ${type}, ${angle} degrees.`);
      });
    </script>
    <script>
      function docReady(fn) {
        // see if DOM is already available
        if (
          document.readyState === "complete" ||
          document.readyState === "interactive"
        ) {
          // call on next available tick
          setTimeout(fn, 1);
        } else {
          document.addEventListener("DOMContentLoaded", fn);
        }
      }

      docReady(function () {
        var resultContainer = document.getElementById("qr-reader-results");
        var lastResult,
          countResults = 0;

        function onScanSuccess(decodedText, decodedResult) {
          window.location.href = `ar.html?vin=` + decodedText;
        }

        const width = window.innerWidth;
        const height = window.innerHeight;
        const aspectRatio = width / height;
        const reverseAspectRatio = height / width;

        let qrboxFunction = function (viewfinderWidth, viewfinderHeight) {
          let minEdgePercentage = 0.7; // 70%
          let minEdgeSize = Math.min(viewfinderWidth, viewfinderHeight);
          let qrboxSize = Math.floor(minEdgeSize * minEdgePercentage);
          return {
            width: qrboxSize,
            height: qrboxSize,
          };
        };

        const formatsToSupport = [Html5QrcodeSupportedFormats.QR_CODE];
        const config = {
          fps: 10, // frame per seconds for qr code scanning
          qrbox: qrboxFunction,
          videoConstraints: {
            facingMode: "environment",
            aspectRatio: 1,
          },
          formatsToSupport,
        };

        var html5QrcodeScanner = new Html5QrcodeScanner(
          "qr-reader",
          config,
          true
        );
        html5QrcodeScanner.render(onScanSuccess);

        document
          .getElementById("html5-qrcode-button-camera-permission")
          .click();
      });
    </script>
  </head>
</html>
