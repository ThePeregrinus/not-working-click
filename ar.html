<!DOCTYPE html>
<html>
  <link rel="stylesheet" href="styles/phone-alert.css" />
  <link rel="stylesheet" href="styles/ar.css" />
  <link
    href="https://fonts.googleapis.com/css?family=Manrope"
    rel="stylesheet"
  />
  <script src="./scripts/aframe-min.js"></script>
  <script src="./scripts/aframe-ar.js"></script>
  <script>
    const endpoint = "https://tds-test2.itorum.ru";

    function isIphone() {
      return /iPhone/.test(navigator.userAgent) && !window.MSStream;
    }

    window.onload = function () {
      if (isIphone()) {
        document.querySelector(".fullscreen").style.display = "none";
      }

      const marker = document.querySelector("a-marker");
      const notificationMessage = document.querySelector(
        ".notification-message"
      );

      marker.addEventListener("markerFound", (e) => {
        notificationMessage.style.display = "none";
        marker.setAttribute("found", true);
      });

      marker.addEventListener("markerLost", (e) => {
        notificationMessage.style.display = "inline-flex";
        marker.setAttribute("found", false);
      });

      const params = new URLSearchParams(new URL(window.location.href).search);
      let vin = null;
      if (params.has("vin")) vin = params.get("vin");

      if (vin) {
        fetch(
          `${endpoint}/api/on_board_information_system/coordinate_points?vin=${vin}`
        )
          .then((res) => res.json())
          .then((res) => {
            res.map((element) => {
              const coords = `${element.coordinates.x} ${element.coordinates.y} ${element.coordinates.z}`;

              const entity = document.createElement("a-entity");
              entity.setAttribute("rotation", "-90 180 0");
              entity.setAttribute("position", coords);
              entity.setAttribute("material", "src: #info");
              entity.setAttribute("geometry", "primitive: circle; radius: 0.2");
              entity.setAttribute("infocomponent", "");
              entity.addEventListener("click", () => openModal(element));

              const follower = document.querySelector("#follower");
              follower.appendChild(entity);
            });
          })
          .catch((e) => {
            res = [
    {
        "title_element": "Переключатель управления АКПП",
        "coordinates": {
            "x": -1.4,
            "y": 2.1,
            "z": -0.25
        },
        "technical_map": [],
        "description": [
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Переключатель передач",
                "code": "KAMAZ54901.1-GDR0-17-02-00-00DDD-110A-A",
                "data_module_id": 32984,
                "publication_id": 2121
            },
            {
                "title": "Автоматическое управление коробкой передач",
                "code": "KAMAZ54901-GDR0-17-02-00-00DDD-112B-A",
                "data_module_id": 32842,
                "publication_id": 2121
            },
            {
                "title": "Ручное управление коробкой передач",
                "code": "KAMAZ54901-GDR0-17-02-00-00DDD-112C-A",
                "data_module_id": 32602,
                "publication_id": 2121
            },
            {
                "title": "Режимы маневрирования \"DM\" и \"RM\"",
                "code": "KAMAZ54901-GDR0-17-02-00-00DDD-112D-A",
                "data_module_id": 32603,
                "publication_id": 2121
            },
            {
                "title": "Режим движения",
                "code": "KAMAZ54901.1-GDR0-17-02-00-00DDD-112H-A",
                "data_module_id": 32987,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Электророзетки ",
        "coordinates": {
            "x": -0.16,
            "y": 5.5,
            "z": -8.45
        },
        "technical_map": [],
        "description": [
            {
                "title": "Электророзетки",
                "code": "KAMAZ54901-CAE3-37-23-00-00DDD-041A-A",
                "data_module_id": 32567,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Вещевой ящик",
        "coordinates": {
            "x": 5.05,
            "y": 0.0,
            "z": 6.0
        },
        "technical_map": [],
        "description": [
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Вещевые ящики и полки",
                "code": "KAMAZ54901-CAE3-82-13-00-00DDD-041A-A",
                "data_module_id": 32569,
                "publication_id": 2121
            },
            {
                "title": "Вещевые ящики в надоконной полке",
                "code": "KAMAZ54901-CAE3-82-13-01-00DDD-041A-A",
                "data_module_id": 32570,
                "publication_id": 2121
            },
            {
                "title": "Доступ к вещевым ящикам спальных мест",
                "code": "KAMAZ54901-CAE3-82-13-00-00DDD-540A-A",
                "data_module_id": 32571,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Электророзетки ",
        "coordinates": {
            "x": 8.53,
            "y": 1.1,
            "z": -10.0
        },
        "technical_map": [],
        "description": [
            {
                "title": "Электророзетки",
                "code": "KAMAZ54901-CAE3-37-23-00-00DDD-041A-A",
                "data_module_id": 32567,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Электророзетки ",
        "coordinates": {
            "x": 5.32,
            "y": 0.0,
            "z": 0.38
        },
        "technical_map": [],
        "description": [
            {
                "title": "Электророзетки",
                "code": "KAMAZ54901-CAE3-37-23-00-00DDD-041A-A",
                "data_module_id": 32567,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Колонка рулевого управления",
        "coordinates": {
            "x": -3.22,
            "y": 4.55,
            "z": -0.33
        },
        "technical_map": [
            {
                "title": "Проверить регулировку колонки рулевого управления в сборе",
                "code": "KAMAZ54901-HB22-34-44-00-00DDD-271A-E",
                "data_module_id": 32404,
                "publication_id": 2027
            }
        ],
        "description": [
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Рулевое управление",
                "code": "KAMAZ54901-UR01-34-00-00-00DDD-040A-Z",
                "data_module_id": 32442,
                "publication_id": 2121
            },
            {
                "title": "Кнопки управления на рулевом колесе",
                "code": "KAMAZ54901-CT02-34-02-01-00DDD-040A-Z",
                "data_module_id": 32451,
                "publication_id": 2121
            },
            {
                "title": "Регулирование положения рулевого колеса",
                "code": "KAMAZ54901-CAE3-34-44-00-00DDD-271A-A",
                "data_module_id": 32545,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Тахограф",
        "coordinates": {
            "x": -2.44,
            "y": 6.25,
            "z": -7.8
        },
        "technical_map": [],
        "description": [
            {
                "title": "Тахограф цифровой",
                "code": "KAMAZ54901-CAE3-38-40-00-00DDD-041A-A",
                "data_module_id": 32568,
                "publication_id": 2121
            },
            {
                "title": "Схема пломбирования автомобиля",
                "code": "KAMAZ54901-UR01-39-04-01-00DDD-067D-Z",
                "data_module_id": 32436,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Блок переключателей на двери водителя",
        "coordinates": {
            "x": -7.8,
            "y": 4.63,
            "z": 2.55
        },
        "technical_map": [],
        "description": [
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Блоки переключателей на двери водителя",
                "code": "KAMAZ54901-CAE3-37-10-01-01DDD-110A-A",
                "data_module_id": 32506,
                "publication_id": 2121
            },
            {
                "title": "Опускание и подъем боковых стекол водителя/пассажира",
                "code": "KAMAZ54901-CAE3-61-04-00-00DDD-110A-A",
                "data_module_id": 32529,
                "publication_id": 2121
            },
            {
                "title": "Регулировка положения верхней секции зеркала заднего вида",
                "code": "KAMAZ54901.2-CAE3-82-01-01-00DDD-110A-A",
                "data_module_id": 32532,
                "publication_id": 2121
            },
            {
                "title": "Обогрев зеркал",
                "code": "KAMAZ54901.1-CAE3-82-01-01-02DDD-110A-A",
                "data_module_id": 32961,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Вещевой ящик",
        "coordinates": {
            "x": 3.55,
            "y": 4.3,
            "z": -9.42
        },
        "technical_map": [],
        "description": [
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Вещевые ящики и полки",
                "code": "KAMAZ54901-CAE3-82-13-00-00DDD-041A-A",
                "data_module_id": 32569,
                "publication_id": 2121
            },
            {
                "title": "Вещевые ящики в надоконной полке",
                "code": "KAMAZ54901-CAE3-82-13-01-00DDD-041A-A",
                "data_module_id": 32570,
                "publication_id": 2121
            },
            {
                "title": "Доступ к вещевым ящикам спальных мест",
                "code": "KAMAZ54901-CAE3-82-13-00-00DDD-540A-A",
                "data_module_id": 32571,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Блок интерфейса пользователя",
        "coordinates": {
            "x": -0.25,
            "y": 5.1,
            "z": -7.9
        },
        "technical_map": [],
        "description": [
            {
                "title": "Назначение и органы управления",
                "code": "KAMAZ54901-CAE3-40-06-00-00DDD-040A-A",
                "data_module_id": 32576,
                "publication_id": 2121
            },
            {
                "title": "Режим работы",
                "code": "KAMAZ54901-CAE3-40-06-00-00DDD-112A-A",
                "data_module_id": 32577,
                "publication_id": 2121
            },
            {
                "title": "Экстренный вызов \"SOS\"",
                "code": "KAMAZ54901-CAE3-40-06-00-00DDD-142A-A",
                "data_module_id": 32578,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Вещевой ящик",
        "coordinates": {
            "x": 10.0,
            "y": -6.6,
            "z": -3.35
        },
        "technical_map": [],
        "description": [
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Вещевые ящики и полки",
                "code": "KAMAZ54901-CAE3-82-13-00-00DDD-041A-A",
                "data_module_id": 32569,
                "publication_id": 2121
            },
            {
                "title": "Вещевые ящики в надоконной полке",
                "code": "KAMAZ54901-CAE3-82-13-01-00DDD-041A-A",
                "data_module_id": 32570,
                "publication_id": 2121
            },
            {
                "title": "Доступ к вещевым ящикам спальных мест",
                "code": "KAMAZ54901-CAE3-82-13-00-00DDD-540A-A",
                "data_module_id": 32571,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Вещевой ящик",
        "coordinates": {
            "x": 5.47,
            "y": 2.47,
            "z": -8.85
        },
        "technical_map": [],
        "description": [
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Вещевые ящики и полки",
                "code": "KAMAZ54901-CAE3-82-13-00-00DDD-041A-A",
                "data_module_id": 32569,
                "publication_id": 2121
            },
            {
                "title": "Вещевые ящики в надоконной полке",
                "code": "KAMAZ54901-CAE3-82-13-01-00DDD-041A-A",
                "data_module_id": 32570,
                "publication_id": 2121
            },
            {
                "title": "Доступ к вещевым ящикам спальных мест",
                "code": "KAMAZ54901-CAE3-82-13-00-00DDD-540A-A",
                "data_module_id": 32571,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Блок интерфейса пользователя",
        "coordinates": {
            "x": 8.42,
            "y": 0.67,
            "z": -9.45
        },
        "technical_map": [],
        "description": [
            {
                "title": "Назначение и органы управления",
                "code": "KAMAZ54901-CAE3-40-06-00-00DDD-040A-A",
                "data_module_id": 32576,
                "publication_id": 2121
            },
            {
                "title": "Режим работы",
                "code": "KAMAZ54901-CAE3-40-06-00-00DDD-112A-A",
                "data_module_id": 32577,
                "publication_id": 2121
            },
            {
                "title": "Экстренный вызов \"SOS\"",
                "code": "KAMAZ54901-CAE3-40-06-00-00DDD-142A-A",
                "data_module_id": 32578,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Рычаг управления стояночной тормозной системой",
        "coordinates": {
            "x": 1.4,
            "y": 0.78,
            "z": 2.4
        },
        "technical_map": [],
        "description": [
            {
                "title": "Рычаг управления электронной стояночной тормозной системой",
                "code": "KAMAZ54901-BV00-35-07-00-00DDD-110A-A",
                "data_module_id": 32619,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Растормаживание стояночной тормозной системы",
                "code": "KAMAZ54901-BV00-35-07-00-00DDD-120A-A",
                "data_module_id": 32620,
                "publication_id": 2121
            },
            {
                "title": "Временный стояночный тормоз, функция \"Auto Hold\"",
                "code": "KAMAZ54901-BV00-35-07-00-00DDD-130A-A",
                "data_module_id": 32622,
                "publication_id": 2121
            },
            {
                "title": "Независимое торможение полуприцепа",
                "code": "KAMAZ54901-BV00-35-07-00-00DDD-112A-A",
                "data_module_id": 32623,
                "publication_id": 2121
            },
            {
                "title": "Растормаживание полуприцепа",
                "code": "KAMAZ54901-BV00-35-07-00-00DDD-510A-A",
                "data_module_id": 32624,
                "publication_id": 2121
            },
            {
                "title": "Притормаживание тягача и полуприцепа",
                "code": "KAMAZ54901-BV00-35-07-00-00DDD-161A-A",
                "data_module_id": 32625,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Вещевой ящик",
        "coordinates": {
            "x": 12.85,
            "y": -1.81,
            "z": -10.82
        },
        "technical_map": [],
        "description": [
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Вещевые ящики и полки",
                "code": "KAMAZ54901-CAE3-82-13-00-00DDD-041A-A",
                "data_module_id": 32569,
                "publication_id": 2121
            },
            {
                "title": "Вещевые ящики в надоконной полке",
                "code": "KAMAZ54901-CAE3-82-13-01-00DDD-041A-A",
                "data_module_id": 32570,
                "publication_id": 2121
            },
            {
                "title": "Доступ к вещевым ящикам спальных мест",
                "code": "KAMAZ54901-CAE3-82-13-00-00DDD-540A-A",
                "data_module_id": 32571,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Блок предохранителей",
        "coordinates": {
            "x": 10.0,
            "y": -9.4,
            "z": 3.25
        },
        "technical_map": [
            {
                "title": "Заменить реле",
                "code": "KAMAZ54901-LV10-37-47-00-00DDD-921A-A",
                "data_module_id": 32405,
                "publication_id": 2027
            },
            {
                "title": "Заменить предохранитель",
                "code": "KAMAZ54901-LA11-37-22-00-00DDD-921A-A",
                "data_module_id": 32406,
                "publication_id": 2027
            }
        ],
        "description": [
            {
                "title": "Расположение реле и предохранителей",
                "code": "KAMAZ54901-CT02-37-22-00-00DDD-055A-A",
                "data_module_id": 32721,
                "publication_id": 2121
            },
            {
                "title": "Проверка и замена предохранителей",
                "code": "KAMAZ54901-VH01-37-22-00-00DDD-921A-A",
                "data_module_id": 32723,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Комбинированый переключатель",
        "coordinates": {
            "x": -5.68,
            "y": 4.3,
            "z": 0.8
        },
        "technical_map": [],
        "description": [
            {
                "title": "Комбинированный переключатель",
                "code": "KAMAZ54901-CAE3-37-09-00-01DDD-110A-A",
                "data_module_id": 32508,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Дальний свет",
                "code": "KAMAZ54901-CAE3-37-11-02-00DDD-110A-A",
                "data_module_id": 32514,
                "publication_id": 2121
            },
            {
                "title": "Указатели поворота",
                "code": "KAMAZ54901-CAE3-37-26-00-00DDD-110A-A",
                "data_module_id": 32519,
                "publication_id": 2121
            },
            {
                "title": "Предупредительный световой сигнал",
                "code": "KAMAZ54901-CAE3-37-38-00-00DDD-110A-A",
                "data_module_id": 32520,
                "publication_id": 2121
            },
            {
                "title": "Стеклоочистители",
                "code": "KAMAZ54901-CAE3-52-05-00-00DDD-040A-A",
                "data_module_id": 32522,
                "publication_id": 2121
            },
            {
                "title": "Стеклоомыватель",
                "code": "KAMAZ54901-CAE3-52-05-01-00DDD-110A-A",
                "data_module_id": 32525,
                "publication_id": 2121
            },
            {
                "title": "Звуковой сигнал",
                "code": "KAMAZ54901-CAE3-37-21-00-00DDD-110A-A",
                "data_module_id": 32526,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Электронный замок",
        "coordinates": {
            "x": -1.5,
            "y": 0.25,
            "z": 1.55
        },
        "technical_map": [],
        "description": [
            {
                "title": "Электронный замок",
                "code": "KAMAZ54902-CAE3-40-14-00-08DDD-040A-Z",
                "data_module_id": 32885,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Пуск двигателя",
                "code": "KAMAZ54901.1-CAE3-40-14-00-08DDD-730A-A",
                "data_module_id": 32980,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Блоки переключателей",
        "coordinates": {
            "x": 3.04,
            "y": 0.89,
            "z": 2.56
        },
        "technical_map": [],
        "description": [
            {
                "title": "Блоки переключателей на панели приборов",
                "code": "KAMAZ54901.1-CAE3-37-09-01-00DDD-110A-A",
                "data_module_id": 32956,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Автономный отопитель кабины",
                "code": "KAMAZ54901-CAE3-81-06-00-00DDD-040A-A",
                "data_module_id": 32555,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Блок управления наружным освещением",
        "coordinates": {
            "x": -6.42,
            "y": 2.75,
            "z": 2.95
        },
        "technical_map": [],
        "description": [
            {
                "title": "Блок управления наружным освещением",
                "code": "KAMAZ54901-CT02-37-09-01-01DDD-110A-A",
                "data_module_id": 32509,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Переключатель света",
                "code": "KAMAZ54901-CT02-37-09-00-05DDD-110A-A",
                "data_module_id": 32510,
                "publication_id": 2121
            },
            {
                "title": "Контурные, габаритные фонари",
                "code": "KAMAZ54901-CAE3-37-31-01-00DDD-110A-A",
                "data_module_id": 32512,
                "publication_id": 2121
            },
            {
                "title": "Ближний свет",
                "code": "KAMAZ54901-CAE3-37-11-01-00DDD-110A-A",
                "data_module_id": 32513,
                "publication_id": 2121
            },
            {
                "title": "Дальний свет",
                "code": "KAMAZ54901-CAE3-37-11-02-00DDD-110A-A",
                "data_module_id": 32514,
                "publication_id": 2121
            },
            {
                "title": "Передние противотуманные фары",
                "code": "KAMAZ54901.1-CAE3-37-43-00-00DDD-110A-A",
                "data_module_id": 32958,
                "publication_id": 2121
            },
            {
                "title": "Задние противотуманные фонари",
                "code": "KAMAZ54901-VH01-37-16-00-05DDD-110A-A",
                "data_module_id": 32516,
                "publication_id": 2121
            },
            {
                "title": "Регулирование угла наклона фар",
                "code": "KAMAZ54901-CT02-37-18-00-00DDD-110A-A",
                "data_module_id": 32521,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Бортовая информационная система",
        "coordinates": {
            "x": 0.0,
            "y": 0.0,
            "z": 0.0
        },
        "technical_map": [],
        "description": [
            {
                "title": "Органы управления",
                "code": "KAMAZ54901-CAE3-40-15-03-10DDD-110A-A",
                "data_module_id": 32911,
                "publication_id": 2121
            },
            {
                "title": "Пульт управления для БИС 1.0 диагональ 10.1 дюйма",
                "code": "KAMAZ54901-LI50-40-15-03-10DDD-110A-A",
                "data_module_id": 32912,
                "publication_id": 2121
            },
            {
                "title": "Кнопка \"ПИТАНИЕ\" для БИС 2.0 диагональ 15.6 дюйма",
                "code": "KAMAZ54901-LI52-40-15-03-10DDD-110A-A",
                "data_module_id": 32474,
                "publication_id": 2121
            },
            {
                "title": "Включение/Выключение БИС 1.0 диагональ 10.1 дюйма. Подсветка экрана",
                "code": "KAMAZ54901-LI50-40-15-03-10DDD-730A-A",
                "data_module_id": 32913,
                "publication_id": 2121
            },
            {
                "title": "Включение/Выключение БИС 2.0 диагональ 15.6 дюйма. Подсветка экрана",
                "code": "KAMAZ54901-LI52-40-15-03-10DDD-730A-A",
                "data_module_id": 32475,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Комбинация приборов",
        "coordinates": {
            "x": -5.5,
            "y": 0.75,
            "z": 0.45
        },
        "technical_map": [],
        "description": [
            {
                "title": "Описание комбинации приборов",
                "code": "KAMAZ54901-CAE3-38-01-00-00DDD-040A-Z",
                "data_module_id": 32886,
                "publication_id": 2121
            },
            {
                "title": "Контрольные сигнализаторы на комбинации приборов",
                "code": "KAMAZ54901-CAE3-38-01-04-00DDD-040A-Z",
                "data_module_id": 32887,
                "publication_id": 2121
            },
            {
                "title": "Главная страница",
                "code": "KAMAZ54901-CAE3-38-01-01-00DDD-041A-Z",
                "data_module_id": 32453,
                "publication_id": 2121
            },
            {
                "title": "Контрольные сигнализаторы на дисплее комбинации приборов",
                "code": "KAMAZ54901-CT02-38-01-04-00DDD-040A-A",
                "data_module_id": 32472,
                "publication_id": 2121
            }
        ]
    },
    {
        "title_element": "Блок переключателей на двери пассажира",
        "coordinates": {
            "x": 15.1,
            "y": -6.8,
            "z": -1.42
        },
        "technical_map": [],
        "description": [
            {
                "title": "Блок переключателей на двери пассажира",
                "code": "KAMAZ54901-CAE3-37-10-01-05DDD-110A-A",
                "data_module_id": 32507,
                "publication_id": 2121
            },
            {
                "title": "Включение и выключение внутреннего освещения кабины клавишными переключателями, расположенными на двери пассажира",
                "code": "KAMAZ54901-CAE3-37-14-00-00DDD-730A-A",
                "data_module_id": 32565,
                "publication_id": 2121
            },
            {
                "title": "Рабочее место водителя",
                "code": "KAMAZ54901-CAE3-50-00-00-00DDD-110A-Z",
                "data_module_id": 32448,
                "publication_id": 2121
            },
            {
                "title": "Опускание и подъем боковых стекол водителя/пассажира",
                "code": "KAMAZ54901-CAE3-61-04-00-00DDD-110A-A",
                "data_module_id": 32529,
                "publication_id": 2121
            }
        ]
    }
]
          
res.map((element) => {
              const coords = `${element.coordinates.x} ${element.coordinates.y} ${element.coordinates.z}`;

              const entity = document.createElement("a-entity");
              entity.setAttribute("rotation", "-90 180 0");
              entity.setAttribute("position", coords);
              entity.setAttribute("material", "src: #info");
              entity.setAttribute("geometry", "primitive: circle; radius: 0.2");
              entity.setAttribute("infocomponent", "");
              entity.addEventListener("click", () => openModal(element));

              const follower = document.querySelector("#follower");
              follower.appendChild(entity);
            });
});

      } else alert("Ошибка клиента: vin не найден");
    };

    function closeModal() {
      const modal = (document.querySelector(".wrapper").style.display = "none");

      document
        .querySelectorAll(".main-content-items")
        .forEach((elem) => elem.parentNode.removeChild(elem));

      [...document.querySelector(".tabs").childNodes].forEach((e) =>
        e.remove()
      );
 
      const toolsBtns = document.querySelector(".modal-tools-button");
      while (toolsBtns.firstChild) {
        toolsBtns.removeChild(toolsBtns.firstChild);
      }
    }

    function reloadPage() {
      location.reload();
    }

    function toogleFullScreen(isModal = false) {
      const icon = document.getElementById("fullscreen-btn");
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
        icon.src = "./assets/tools-windowed.svg";

        if (isModal) {
          modalIcon = document.querySelector(".modal-fullscreen-btn");
          modalIcon.src = "./assets/modal-windowed.svg";
        }
      } else if (document.exitFullscreen) {
        document.exitFullscreen();
        icon.src = "./assets/tools-fullscreen.svg";

        if (isModal) {
          modalIcon = document.querySelector(".modal-fullscreen-btn");
          modalIcon.src = "./assets/modal-fullscren.svg";
        }
      }
    }

    function returnBack() {
      window.location.href = endpoint;
    }

    function createContentItem(
      mainContentItems,
      title,
      publication_id,
      data_module_id
    ) {
      const mainContentItem = document.createElement("div");
      mainContentItem.className = "main-content-item";

      const mainContentText = document.createElement("div");
      mainContentText.className = "main-content-text-and-logo";

      const portalIcon = document.createElement("img");

      portalIcon.src = "./assets/portal.svg";
      portalIcon.alt = "portal";

      mainContentText.appendChild(portalIcon);
      const textNode = document.createTextNode(title);
      mainContentText.appendChild(textNode);

      mainContentItem.onclick = () => {
        window.open(
          `${endpoint}/publications/viewer?p=${publication_id}&m=${data_module_id}`,
          "_blank"
        );
      };

      const mainContentButton = document.createElement("img");
      mainContentButton.className = "main-content-button";
      mainContentButton.src = "./assets/right-arrow.svg";
      mainContentButton.alt = "open md";

      mainContentItem.appendChild(mainContentText);
      mainContentItem.appendChild(mainContentButton);

      mainContentItems.append(mainContentItem);

      const container = document.querySelector(".main-content-container");
      container.appendChild(mainContentItems);
    }
    function openModal(obj) {
      const marker = document.querySelector("a-marker");
      if (marker.getAttribute("found") === "true") {
        const tools = document.querySelector(".modal-tools-button");

        const closeIcon = document.createElement("img");
        closeIcon.src = "./assets/modal-close.svg";
        closeIcon.alt = "Close modal and return to AR";
        closeIcon.addEventListener("click", closeModal);
        closeIcon.classList.add("svg-icon");

        const toogleFullScreenIcon = document.createElement("img");
        toogleFullScreenIcon.src = document.fullscreenElement
          ? "./assets/modal-windowed.svg"
          : "./assets/modal-fullscren.svg";

        toogleFullScreenIcon.addEventListener("click", () =>
          toogleFullScreen(true)
        );

        toogleFullScreenIcon.classList.add("modal-fullscreen-btn", "svg-icon");

        tools.appendChild(closeIcon);

        if (!isIphone()) {
          tools.appendChild(toogleFullScreenIcon);
        }

        const modal = (document.querySelector(".wrapper").style.display =
          "flex");

        const headerText = document.querySelector(".header-text");
        headerText.textContent = obj.title_element;

        const { description, technical_map: technicalMap } = obj;

        const mainContentItems = document.createElement("div");
        mainContentItems.className = "main-content-items";

        const tabs = document.querySelector(".tabs");
        let counter = -1;

        if (description.length) {
          counter++;
          const tab = document.createElement("div");
          tab.addEventListener("click", () => handleTab(0));
          tab.className = "tab tab-active";
          tab.textContent = "Руководство по эксплуатации";
          tabs.append(tab);

          description.forEach(({ title, publication_id, data_module_id }) => {
            createContentItem(
              mainContentItems,
              title,
              publication_id,
              data_module_id
            );
          });
        }

        const mainHiddenContentItems = document.createElement("div");
        mainHiddenContentItems.className =
          counter === -1
            ? "main-content-items"
            : "main-content-items hidden-item";

        if (technicalMap.length) {
          counter++;
          const tab = document.createElement("div");
          tab.addEventListener("click", () => handleTab(1));
          tab.className = counter === 0 ? "tab tab-active" : "tab tab-inactive";
          tab.textContent = "Технические карты";
          tabs.append(tab);
          technicalMap.forEach(({ title, publication_id, data_module_id }) => {
            createContentItem(
              mainHiddenContentItems,
              title,
              publication_id,
              data_module_id
            );
          });
        }

        if (counter === 0) {
          const tab = document.querySelector(".tab");
          tab.style.setProperty("padding", "0");
          tab.style.setProperty("border", "none");
          tab.style.setProperty("width", "auto");
          tab.style.setProperty("color", "black");
          tab.style.setProperty("background-color", "transparent");
          tab.classList.remove("tab-active");
        }
      }
    }

    function handleTab(tabIndex) {
      const tabs = document.querySelectorAll(".tab");
      const contentItems = document.querySelectorAll(".main-content-items");

      tabs.forEach((tab, index) => {
        tab.classList.remove("tab-active");
        tab.classList.add("tab-inactive");
        contentItems[index].classList.add("hidden-item");
      });

      tabs[tabIndex].classList.remove("tab-inactive");
      tabs[tabIndex].classList.add("tab-active");
      contentItems[tabIndex].classList.remove("hidden-item");
    }

    function closeOrientationalModal() {
      const modal = document.querySelector(".wrapper-orientation-alert");
      modal.style.display = "none";

      const bodyElements = document.querySelectorAll(
        "body > *:not(.wrapper-orientation-alert)"
      );
      bodyElements.forEach((element) => {
        element.style.filter = "none";
      });
    }
  </script>
  <script>
    AFRAME.registerComponent("markerhandler", {
      init: function () {
        this.p = new THREE.Vector3();
        this.q = new THREE.Quaternion();
        this.s = new THREE.Vector3();

        let marker = this.el;
        let follower = document.querySelector("#follower");

        marker.addEventListener("markerFound", function () {
          markerVisible = true;
          follower.object3D.visible = true;
        });

        marker.addEventListener("markerLost", function () {
          markerVisible = false;
          follower.object3D.visible = false;
          console.log("lost");
        });
      },

      tick: function (time, deltaTime) {
        let marker = this.el;
        let follower = document.querySelector("#follower");

        marker.object3D.getWorldPosition(this.p);
        marker.object3D.getWorldQuaternion(this.q);
        marker.object3D.getWorldScale(this.s);

        follower.object3D.position.lerp(this.p, 1);
        follower.object3D.quaternion.slerp(this.q, 0.025);
        follower.object3D.scale.lerp(this.s, 0.025);
      },
    });

    AFRAME.registerComponent("infocomponent", {
      schema: {
        link: { type: "string", default: "" },
        name: { type: "string", default: "herohoehero" },
      },

      init: function () {
        console.log("init function:", this.el);
      },
      tick: function (time, timeDelta) {
        let plane = this.el;
        let camera = document.querySelector("[camera]");
        var position = camera.object3D.rotation;
        plane.object3D.lookAt(
          new THREE.Vector3(position.x, position.y, position.z)
        );
      },
    });
  </script>

  <body style="margin: 0px; overflow: hidden">
    <div class="wrapper-orientation-alert">
      <div class="modal-alert">
        <div class="phone-img">
          <img src="./assets/phone.svg" />
        </div>
        <div class="modal-alert-container">
          <div class="modal-alert-text">
            Для корректной работы с дополненной реальностью, поверните
            устройство в горизонтальное положение
          </div>
        </div>
      </div>
    </div>
    <div class="wrapper">
      <div class="modal">
        <div class="modal-content">
          <div class="modal-tools-button"></div>
          <div class="main">
            <div class="header-text">Информация</div>
            <div class="tabs"></div>
            <div class="main-content">
              <div class="main-content-container"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="notification-wrapper">
      <div class="tools-button">
        <img
          class="svg-icon"
          alt="return to portal"
          src="./assets/tools-return.svg"
          onclick="returnBack()"
        />
        <img
          class="svg-icon fullscreen"
          alt="fullscreen toogle"
          src="./assets/tools-fullscreen.svg"
          id="fullscreen-btn"
          onclick="toogleFullScreen()"
        />
        <img
          class="svg-icon"
          alt="reload page"
          src="./assets/tools-reload.svg"
          onclick="reloadPage()"
        />
      </div>
      <div class="notification-message">
        Убедитесь, что AR-маркер находится в поле зрения камеры
      </div>
    </div>
    <a-scene
      embedded
      arjs="trackingMethod: best; sourceType: webcam; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;"
      cursor="fuse: false; rayOrigin: mouse;"
      vr-mode-ui="enabled: false"
    >
      <a-assets>
        <img id="info" src="info.png" alt="info" />
      </a-assets>

      <a-marker
        found="false"
        preset="custom"
        type="pattern"
        url="marker.patt"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;"
        id="markerA"
        markerhandler
        size="1"
        smooth="true"
        smoothCount="5"
        smoothTolerance="0.05"
        smoothThreshold="5"
      >
      </a-marker>

      <!-- <a-marker
        found="false"
        preset="hiro"
        raycaster="objects: .clickable"
        emitevents="true"
        cursor="fuse: false; rayOrigin: mouse;"
        id="markerA"
        markerhandler
        size="1"
        smooth="true"
        smoothCount="5"
        smoothTolerance="0.05"
        smoothThreshold="5"
      >
      </a-marker> -->

      <a-entity id="follower"> </a-entity>
      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
